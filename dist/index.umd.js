!function(e,n){"object"==typeof exports&&"undefined"!=typeof module?n(exports,require("@metaplex-foundation/mpl-token-metadata"),require("@metaplex-foundation/umi"),require("@metaplex-foundation/umi-bundle-defaults"),require("isomorphic-unfetch"),require("@coral-xyz/anchor"),require("@solana/web3.js")):"function"==typeof define&&define.amd?define(["exports","@metaplex-foundation/mpl-token-metadata","@metaplex-foundation/umi","@metaplex-foundation/umi-bundle-defaults","isomorphic-unfetch","@coral-xyz/anchor","@solana/web3.js"],n):n((e||self).solanaHelperFunctions={},e.mplTokenMetadata,e.umi,e.umiBundleDefaults,e.isomorphicUnfetch,e.anchor,e.web3_js)}(this,function(e,n,t,r,i,o,a){function s(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var u=/*#__PURE__*/s(i);function c(e,n,t){if(!e.s){if(t instanceof f){if(!t.s)return void(t.o=c.bind(null,e,n));1&n&&(n=t.s),t=t.v}if(t&&t.then)return void t.then(c.bind(null,e,n),c.bind(null,e,2));e.s=n,e.v=t;const r=e.o;r&&r(e)}}var f=/*#__PURE__*/function(){function e(){}return e.prototype.then=function(n,t){var r=new e,i=this.s;if(i){var o=1&i?n:t;if(o){try{c(r,1,o(this.v))}catch(e){c(r,2,e)}return r}return this}return this.o=function(e){try{var i=e.v;1&e.s?c(r,1,n?n(i):i):t?c(r,1,t(i)):c(r,2,i)}catch(e){c(r,2,e)}},r},e}();function l(e){return e instanceof f&&1&e.s}function h(e,n){try{var t=e()}catch(e){return n(e)}return t&&t.then?t.then(void 0,n):t}function v(e,n,t){if(!e.s){if(t instanceof m){if(!t.s)return void(t.o=v.bind(null,e,n));1&n&&(n=t.s),t=t.v}if(t&&t.then)return void t.then(v.bind(null,e,n),v.bind(null,e,2));e.s=n,e.v=t;const r=e.o;r&&r(e)}}var m=/*#__PURE__*/function(){function e(){}return e.prototype.then=function(n,t){var r=new e,i=this.s;if(i){var o=1&i?n:t;if(o){try{v(r,1,o(this.v))}catch(e){v(r,2,e)}return r}return this}return this.o=function(e){try{var i=e.v;1&e.s?v(r,1,n?n(i):i):t?v(r,1,t(i)):v(r,2,i)}catch(e){v(r,2,e)}},r},e}();function d(e){return e instanceof m&&1&e.s}var p=function(e,n,t,r){try{return Promise.resolve(Promise.all(n.map(function(n){try{var i=t instanceof a.Keypair?new o.Wallet(t):t;return n instanceof a.Transaction?(n.recentBlockhash=r,n.feePayer=i.publicKey,Promise.resolve(i.signTransaction(n)).then(function(n){return Promise.resolve(e.sendRawTransaction(n.serialize(),{skipPreflight:!0,preflightCommitment:"confirmed"}))})):(n.message.recentBlockhash=r,Promise.resolve(i.signTransaction(n)).then(function(n){return Promise.resolve(e.sendRawTransaction(n.serialize(),{skipPreflight:!0,preflightCommitment:"confirmed"}))}))}catch(e){return Promise.reject(e)}}))).then(function(n){var t=[],r=!1,i=0,o=function(e,n,t){for(var r;;){var i=e();if(d(i)&&(i=i.v),!i)return o;if(i.then){r=0;break}var o=t();if(o&&o.then){if(!d(o)){r=1;break}o=o.s}if(n){var a=n();if(a&&a.then&&!d(a)){r=2;break}}}var s=new m,u=v.bind(null,s,2);return(0===r?i.then(f):1===r?o.then(c):a.then(l)).then(void 0,u),s;function c(r){o=r;do{if(n&&(a=n())&&a.then&&!d(a))return void a.then(l).then(void 0,u);if(!(i=e())||d(i)&&!i.v)return void v(s,1,o);if(i.then)return void i.then(f).then(void 0,u);d(o=t())&&(o=o.v)}while(!o||!o.then);o.then(c).then(void 0,u)}function f(e){e?(o=t())&&o.then?o.then(c).then(void 0,u):c(o):v(s,1,o)}function l(){(i=e())?i.then?i.then(f).then(void 0,u):f(i):v(s,1,o)}}(function(){return!r},void 0,function(){return Promise.resolve(y(5e3)).then(function(){return Promise.resolve(e.getSignatureStatuses(n)).then(function(e){console.log(e);var o=null==e?void 0:e.value;if(i>10)for(var a=0;a<o.length;a++){var s=o[a];t.push(null===s?{signature:n[a],error:!0,message:"Transaction dropped"}:null!==(null==s?void 0:s.err)?{signature:n[a],error:!0,message:"Transaction failed"}:"finalized"===(null==s?void 0:s.confirmationStatus)||"confirmed"===(null==s?void 0:s.confirmationStatus)?{signature:n[a],error:!1,message:"Transaction confirmed"}:{signature:n[a],error:!0,message:"Could not confirm transaction"}),r=!0;break}if(o.filter(function(e){return"confirmed"===(null==e?void 0:e.confirmationStatus)||"finalized"===(null==e?void 0:e.confirmationStatus)}).length===o.length)r=!0,t.push.apply(t,o.map(function(e,t){return{signature:n[t],error:!1,message:"Transaction confirmed"}}));else if(o.filter(function(e){return null===e}).length>0&&i<8);else{for(var u=0;u<o.length;u++){var c=o[u];t.push(null===c?{signature:n[u],error:!0,message:"Transaction dropped"}:null!==(null==c?void 0:c.err)?{signature:n[u],error:!0,message:"Transaction failed"}:"finalized"===(null==c?void 0:c.confirmationStatus)||"confirmed"===(null==c?void 0:c.confirmationStatus)?{signature:n[u],error:!1,message:"Transaction confirmed"}:{signature:n[u],error:!0,message:"Could not confirm transaction"})}r=!0}i++})})});return o&&o.then?o.then(function(){return t}):t})}catch(e){return Promise.reject(e)}},g=function(e,n,t,r){void 0===r&&(r=2e-5);try{var i,o=function(){var n=i.value.unitsConsumed+500,t=Math.floor(r/n*Math.pow(10,9))*Math.pow(10,6),o=n*(t/Math.pow(10,6));console.log("Expected fee: ",o/Math.pow(10,9)," SOL");var s=[a.ComputeBudgetProgram.setComputeUnitLimit({units:n}),a.ComputeBudgetProgram.setComputeUnitPrice({microLamports:t})];if(e instanceof a.Transaction)e.add.apply(e,s);else{var u,c=a.TransactionMessage.decompile(e.message);(u=c.instructions).unshift.apply(u,s),e.message=c.compileToV0Message()}return e},s=e instanceof a.Transaction?(e.feePayer=t,Promise.resolve(n.simulateTransaction(e)).then(function(e){i=e})):Promise.resolve(n.simulateTransaction(e)).then(function(e){i=e});return Promise.resolve(s&&s.then?s.then(o):o())}catch(e){return Promise.reject(e)}},y=function(e){try{return Promise.resolve(new Promise(function(n){return setTimeout(n,e)}))}catch(e){return Promise.reject(e)}};const b="undefined"!=typeof Symbol?Symbol.iterator||(Symbol.iterator=Symbol("Symbol.iterator")):"@@iterator";function P(e,n,t){if(!e.s){if(t instanceof w){if(!t.s)return void(t.o=P.bind(null,e,n));1&n&&(n=t.s),t=t.v}if(t&&t.then)return void t.then(P.bind(null,e,n),P.bind(null,e,2));e.s=n,e.v=t;var r=e.o;r&&r(e)}}var w=/*#__PURE__*/function(){function e(){}return e.prototype.then=function(n,t){var r=new e,i=this.s;if(i){var o=1&i?n:t;if(o){try{P(r,1,o(this.v))}catch(e){P(r,2,e)}return r}return this}return this.o=function(e){try{var i=e.v;1&e.s?P(r,1,n?n(i):i):t?P(r,1,t(i)):P(r,2,i)}catch(e){P(r,2,e)}},r},e}();function T(e){return e instanceof w&&1&e.s}e.addComputeAndPriority=g,e.getAssetsForWallet=function(e,i,o,a){void 0===a&&(a=!0);try{var s,v=function(a){return s?a:Promise.resolve(function(e,i){try{return Promise.resolve(h(function(){var o=r.createUmi(i).use(n.mplTokenMetadata());return Promise.resolve(n.fetchAllDigitalAssetByOwner(o,t.publicKey(e)))},function(e){return console.error(e),new Error("Error fetching assets")}))}catch(e){return Promise.reject(e)}}(e,i||"mainnet"===o?"https://api.mainnet-beta.solana.com":"devnet"===o?"https://api.devnet.solana.com":"testnet"===o?"https://api.testnet.solana.com":"localhost"===o?"http://localhost:8899":"https://api.mainnet-beta.solana.com"))};if(!e)return Promise.resolve(new Error("Address is required"));var m=function(e){return e.length>44||e.length<32?{error:!0,message:"Invalid public key length"}:function(e){return/^[A-HJ-NP-Za-km-z1-9]*$/.test(e)}(e)?{error:!1,message:"Valid public key"}:{error:!0,message:"Non base58 characters in public key"}}(e);if(m.error)return Promise.resolve(new Error(m.message));var d=function(){if(a&&"mainnet"===o)return Promise.resolve(function(e,n,t){void 0===t&&(t=!1);try{return Promise.resolve(h(function(){var r=1,i=[],o=function(e,n,t){for(var r;;){var i=e();if(l(i)&&(i=i.v),!i)return o;if(i.then){r=0;break}var o=t();if(o&&o.then){if(!l(o)){r=1;break}o=o.s}if(n){var a=n();if(a&&a.then&&!l(a)){r=2;break}}}var s=new f,u=c.bind(null,s,2);return(0===r?i.then(v):1===r?o.then(h):a.then(m)).then(void 0,u),s;function h(r){o=r;do{if(n&&(a=n())&&a.then&&!l(a))return void a.then(m).then(void 0,u);if(!(i=e())||l(i)&&!i.v)return void c(s,1,o);if(i.then)return void i.then(v).then(void 0,u);l(o=t())&&(o=o.v)}while(!o||!o.then);o.then(h).then(void 0,u)}function v(e){e?(o=t())&&o.then?o.then(h).then(void 0,u):h(o):c(s,1,o)}function m(){(i=e())?i.then?i.then(v).then(void 0,u):v(i):c(s,1,o)}}(function(){return!!r},void 0,function(){return Promise.resolve(u.default(n,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({jsonrpc:"2.0",id:1,method:"getAssetsByOwner",params:{ownerAddress:e,page:r,limit:100,options:{showUnverfifiedCollections:!t}}})})).then(function(e){return Promise.resolve(e.json()).then(function(e){i.push.apply(i,e.result.items),1e3!==e.result.total?r=!1:r++})})});return o&&o.then?o.then(function(){return i}):i},function(e){return console.error(e),new Error("Error fetching assets")}))}catch(e){return Promise.reject(e)}}(e,i)).then(function(e){return s=1,e});if(a&&"mainnet"!==o){var n=new Error("DAS is only available on mainnet");return s=1,n}}();return Promise.resolve(d&&d.then?d.then(v):v(d))}catch(e){return Promise.reject(e)}},e.sendAndConfirmAllSmartTransactions=function(e,n,t,r){try{var i=function(){return Promise.resolve(t.getLatestBlockhash()).then(function(r){return Promise.resolve(p(t,n,e,r.blockhash))})},o=function(e,n,t){if("function"==typeof e[b]){var r,i,o,a=e[b]();if(function e(t){try{for(;!(r=a.next()).done;)if((t=n(r.value))&&t.then){if(!T(t))return void t.then(e,o||(o=P.bind(null,i=new w,2)));t=t.v}i?P(i,1,t):i=t}catch(e){P(i||(i=new w),2,e)}}(),a.return){var s=function(e){try{r.done||a.return()}catch(e){}return e};if(i&&i.then)return i.then(s,function(e){throw s(e)});s()}return i}if(!("length"in e))throw new TypeError("Object is not iterable");for(var u=[],c=0;c<e.length;c++)u.push(e[c]);return function(e,n,t){var r,i,o=-1;return function t(a){try{for(;++o<e.length;)if((a=n(o))&&a.then){if(!T(a))return void a.then(t,i||(i=P.bind(null,r=new w,2)));a=a.v}r?P(r,1,a):r=a}catch(e){P(r||(r=new w),2,e)}}(),r}(u,function(e){return n(u[e])})}(n,function(n){return Promise.resolve(g(n,t,e.publicKey,r||2e-5)).then(function(e){n=e})});return Promise.resolve(o&&o.then?o.then(i):i())}catch(e){return Promise.reject(e)}},e.sendAndConfirmTransactions=p});
